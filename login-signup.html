<!DOCTYPE html>
 <html lang="it">
 <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="login-signup.css">
    <link rel="icon" href="immagini/logo_real.ico" type="image/x-icon">
    <title> Pagina di login/signup</title>
 </head>
 <body>
    <input type="checkbox" id="check">
    <div class="container">
        <div class="login page">
            <div class="heading">Login</div>
            <form action="#">
                <div class="switch">
                    <span>Non hai un account?</span>
                    <label for="check">Sign up Now</label>
                </div>
                <div class="entryarea">
                    <input type="text" required id="emailL">
                    <div class="labelline">Inserisci la tua email</div>
                </div>
                <div class="entryarea">
                    <input type="password" required id="passwordL">
                    <div class="labelline">inserisci il tuo PIN</div>
                    
                </div>
                
                <a href="#">
                    Per problemi: rappresentantiliceolevi@gmail.com
                </a>
                
                <input type="submit" value="Login" id="btn" onclick="clickLogin()">
                
                
            </form>
        </div>
        <div class="signup page">
            <div class="heading">Sign up</div>
            <form action="#">
                <div class="entryarea">
                    <input type="text" required id="nameS">
                    <div class="labelline">Nome</div>
                </div>
                <div class="entryarea">
                    <input type="text" required id="surnameS">
                    <div class="labelline">Cognome</div>
                </div>
                <div class="entryarea">
                        <input type="email" required id="emailS">
                        <div class="labelline">Email</div>
                </div>
                <div class="entryarea">
                    <input type="class" required id="classeS">
                    <div class="labelline">Classe <span style="color: rgba(158, 158, 158, 0.715); font-style: italic; font-size: 0.7em;" >(Solo nel formato: 4^ESA, 5^ESA...)</span></div>
                </div>
                <div class="entryarea">
                    <input type="password" required id="passwordS">
                    <div class="labelline">PIN <span style="color: rgba(158, 158, 158, 0.715); font-style: italic; font-size: 0.7em;" >(4 cifre)</span> </div>
                </div>
                <div class="switch">
                    <span>Possiedi già un account?</span>
                    <label for="check">Login Now</label>
                </div>
                <input type="submit" value="Signup" id="btn" onclick="clickRegistrati()">
                <div class="switch">
                    <span>By clicking the “Signup” button or using the social login options, you are creating an account, and agree to our non-existing Terms of Service and Privacy Policy</span>
                </div>
            </form>
        </div>
    </div>
    <div id="logo-container">
        <a href="index.html" target="_self">
        <div id="Square"></div>
        <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="Frame 1">
            <g id="Ls-group">
            <path id="L-left" opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M44.3334 12.6667H26.6667V93.6667H44.3334H72.6667V77H44.3334L44.3334 12.6667Z" fill="white"/>
            <path id="L-right" opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M75.6666 108H93.3333L93.3333 27H75.6666H47.3333V43.6667H75.6666L75.6666 108Z" fill="white"/>
            </g>
            </g>
        </svg>
        <div class="h1"><h1>Liceo Levi</h1><h4>montebelluna</h4></div>
        </a>
    </div>
    <script>


document.addEventListener('DOMContentLoaded', setupFormValidation);

function setupFormValidation() {
    const emailInput = document.getElementById('emailS');
    const pinInput = document.getElementById('passwordS');
    const numberInput = document.getElementById('number1');
    const letterInput = document.getElementById('letter1');
    const sectionInput = document.getElementById('section1');

    emailInput.addEventListener('input', validateEmail);
    pinInput.addEventListener('input', validatePin);
    numberInput.addEventListener('input', () => validateDatalist(numberInput, 'number'));
    letterInput.addEventListener('input', () => validateDatalist(letterInput, 'letter'));
    sectionInput.addEventListener('input', () => validateDatalist(sectionInput, 'section'));

    function validateEmail() {
        if (!/\S+@\S+\.\S+/.test(emailInput.value)) {
            emailInput.style.border = '1px solid red'; // Email is invalid
        } else {
            emailInput.style.border = ''; // Email is valid
        }
    }

    function validatePin() {
        if (!/^[0-9]{4}$/.test(pinInput.value)) {
            pinInput.style.border = '1px solid red'; // PIN is invalid
        } else {
            pinInput.style.border = ''; // PIN is valid
        }
    }

    function validateDatalist(input, listId) {
        const list = document.getElementById(listId);
        const options = Array.from(list.options).map(option => option.value);
        if (!options.includes(input.value)) {
            input.style.border = '1px solid red'; // The value is not in the list
        } else {
            input.style.border = ''; // The value is valid
        }
    }
}



     document.addEventListener("DOMContentLoaded", function() {
        const images = document.querySelectorAll('img');
        images.forEach(image => {
            image.setAttribute('loading', 'lazy');
        });
        });

        function clickRegistrati() {
            event.preventDefault();  //prevenire il refresh della pagina
            var email = document.getElementById("emailS").value;
            var nomestud = document.getElementById("nameS").value;
            var cognomestud = document.getElementById("surnameS").value;
            var classe = document.getElementById("classeS").value;
            var pin = document.getElementById("passwordS").value;

            register(email, nomestud, cognomestud, classe, pin);
        }

        function register(email, nomestud, cognomestud, classe, pin) {
            const userData = {
                email: email,
                nomestud: nomestud,
                cognomestud: cognomestud,
                classe: classe,
                pin: pin
            };

            fetch('https://gaf-backend.onrender.com/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(userData)
            })
            .then(response => {
                if (!response.ok) throw new Error('Failed to fetch');
                return response.json();
            })
            .then(data => {
                if (data.message) {
                    window.location.href = "login-signup.html"; 
                }
            })
            .catch(error => {
                console.error("Registration failed:", error);
                alert("errore: non siamo stati in grado di registrati, refresha ");
            });
        }





        function clickLogin() {
            var email = document.getElementById("emailL").value;
            var pin = document.getElementById("passwordL").value;
            // Usa gli alert per controllare che i valori siano corretti
            login(email, pin);
        }


        function login(email, pin) {
            event.preventDefault(); 
        // Prepara i dati da inviare
        const userData = {
            email,  pin
        };
  
        // Invia la richiesta al server utilizzando fetch (utilizzate sempre questo format per le richieste)
        fetch('https://gaf-backend.onrender.com/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(userData)
        })
        .then(response => response.json()) // Trasforma la risposta in JSON
        .then(data => 
        {
            if (data.message) {
            console.log("Successo:", data.message);
            window.location.href="index.html";
            sessionStorage.email=email;
            // aggiungere qui il codice su cosa fare in caso di successo
            }
            else
            {
                alert("Email o PIN sbagliati: riprova");

            }
        })
        .catch(error => {
            console.error("Errore:", error);
            alert("ERROR 404, refresha:");
            // aggiungere qui il codice su cosa fare in caso di errore
        });
    }
        </script>
 </body>
 </html>
